## 顺序一致性

在并发情况下，要得到**顺序一致性**的保证，要保证两点

1. 所有的进程豆一相同的顺序观察到操作

2. 同一进程的操作在排序以后保持先后不变

   ![image-20220811142701518](D:\Computer-Science-KnowLedge\files\pic\image-20220811142701518.png)

对于上图的操作而言，虽然 P1 的操作比 P2 先执行，但并不保证在全局的视图中， P1 的操作是先于 P2 的，但是一旦顺序确定，每个读取线程读取这两个操作所产生的值的顺序是一致的。

如果在 时间段2 ，P1 进行了读取操作，那么 P1 的写操作将会对所有人可见，这是基于条件1的保证， P1 已经读到了 P1 的写，而此时 P2 还没有写，所以 P1 的写在全局的顺序一定是先于 P2 的写的，用内存屏障可以实现这一点。

### 多核单机体系下的线性一致性

而原子操作能原子地改变某个变量的全局视图，因此能实现线性一致性，（如果能保证操作的原子性，也能用内存屏障来实现，例如 Java 中的 volatile）

### 在分布式系统下对两种一致性的思考

对于 raft ，所有的操作的全局视图都是一致的，写操作成功后立马全局可见，所以具有线性一致性。

而 zk 中，写操作是全局有序的，并且写操作提交后对后续的写操作也可见（全局的 zxid 保证），因此 zk 的写操作是具有线性一致性的（这种对读取没有影响的线性一致是否能称为线性一致？），但是某一节点 P1 的写操作对后续的另外一个节点 P2 不一定可见，但是如果 P2 在读之前进行写操作，那么 P1 的写操作也会全局可见。 

#### 其他的思考

在理解这些概念的时候，不要先关注具体的实现，因为实现只是服务于概念的，而概念又服务于其具体的作用，用从顶向下的方法思考，先思考为什么要有线性一致和顺序一致，再看在不同的系统下二者是如何实现的（单核、多核、分布式）。